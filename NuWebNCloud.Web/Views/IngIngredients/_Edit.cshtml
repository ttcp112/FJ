@model NuWebNCloud.Shared.Models.Ingredients.IngredientModel
@using NuWebNCloud.Shared.Utilities;
@{
    ViewBag.Title = "Ingredients - Edit";
    //Layout = "~/Views/Shared/_Layout.cshtml";
}
<div role="main" class="right_col">
    @*<div class="se-pre-con" style="display: none;"></div>*@
    <div class="">
        <div class="page-title">
            <div class="title_left" style="padding:10px 0px;">
                @Html.Partial("~/Views/Shared/_breadcrumb.cshtml",
                    /*new Dictionary<string, string> { { "A", "Inventory Management" }, { "B", "Recipe" }, { "C", "Ingredients - Edit" } })*/
                    new Dictionary<string, string> { { "A", Html.Raw(_AttributeForLanguage.CurrentUser.GetLanguageTextFromKey("Inventory Management")).ToString() }, { "B", Html.Raw(_AttributeForLanguage.CurrentUser.GetLanguageTextFromKey("Recipe")).ToString() }, { "C", Html.Raw(_AttributeForLanguage.CurrentUser.GetLanguageTextFromKey("Ingredients")) +" - " + Html.Raw(_AttributeForLanguage.CurrentUser.GetLanguageTextFromKey("Edit")) } })
            </div>
            <div class="clearfix"></div>
            <div class="row">
                <div class="col-md-12 col-sm-12 col-xs-12 x_panel">
                    <div class="x_content">
                        <div class="row text-right">
                            <ul class="header-buttons pull-right list-inline">
                                <li><a href="javascript:void(0)" class="btn btn-success" id="btn-actives" onclick="SubmitForm('.edit-form')"><i class="fa fa-save"></i>&nbsp;@Html.Raw(_AttributeForLanguage.CurrentUser.GetLanguageTextFromKey("Save"))</a></li>
                                <li><a href="javascript:void(0)" class="btn btn-danger" id="btn-delete" onclick="CloseDetail(); return false;"><i class="fa fa-times"></i>&nbsp;@Html.Raw(_AttributeForLanguage.CurrentUser.GetLanguageTextFromKey("Cancel"))</a></li>
                            </ul>
                        </div>
                        <div class="box-body" style="display:block;">
                            @using (@Html.BeginForm("Edit", "IngIngredients", FormMethod.Post, new { @class = "form-horizontal edit-form" }))
                            {
                                @Html.Partial("_Form", Model)
                            }
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>
<script type="text/javascript">
    //$(".edit-form").submit(function (e) {
    //    $.ajax({
    //        url: $(this).attr('action'),
    //        type: "POST",
    //        data: new FormData(this),
    //        contentType: false,
    //        success: function () {

    //        }
    //    });
    //});

    $(".edit-form").submit(function (e) {
        var isSubmit = true;
        $.each($('.IngUsageUOM:visible'), function () {
            var div = $(this);
            var OffSet = $(div).find('#hidOffSet').val();
            var ReceivingQty = $(div).find('#txtReceivingQty').val();
            var IngUOM = $(div).find('#ddlIngUOM').val();
            if (IngUOM == '') {
                $('#ltrValidate_' + OffSet).html('@Html.Raw(_AttributeForLanguage.CurrentUser.GetLanguageTextFromKey("Please choose uom"))');
                isSubmit = false;
            } else {
                if (ReceivingQty <= 0) {
                    $('#ltrValidate_' + OffSet).html('@Html.Raw(_AttributeForLanguage.CurrentUser.GetLanguageTextFromKey("Receiving Quantity is required"))');
                    isSubmit = false;
                } else {
                    $('#ltrValidate_' + OffSet).html('');
                }
            }
        });
        if (isSubmit) {
            $('.se-pre-con').show();
            $.ajax({
                url: $(this).attr('action'),
                type: "post",
                data: new FormData(this),
                processData: false,
                contentType: false,
                success: function () {
                    $('.se-pre-con').hide();
                    CloseDetail();
                    Search();
                },
                error: function (jqXHR, textStatus, errorThrown) {
                    $('.se-pre-con').hide();
                    $(".detail-view").html(jqXHR.responseText);
                },
                complete: function (data) {
                    //$('.se-pre-con').hide();
                }
            });
            e.preventDefault();
        } else {
            return false;
        }
    });

    var baseUOM = "";
    var _IngredientId = "";
    var _CompnanyId = "";

    $(document).ready(function () {
        $("#companyDdl").select2({
            placeholder: "@Html.Raw(_AttributeForLanguage.CurrentUser.GetLanguageTextFromKey("Please choose company"))",
            allowClear: true
        });

        _IngredientId = '@Model.Id';
        _CompnanyId = '@Model.CompanyId';
        var heightDivSupplier = $('.cls_Supplier_Ingredient').length;
        if (heightDivSupplier > 10) {
            $("#tab_SelectedSupplier").css({ "overflow": "auto", "height": "500px" })
        }
    });

    $(".selectUOM").select2({
        placeholder: "@Html.Raw(_AttributeForLanguage.CurrentUser.GetLanguageTextFromKey("Please choose UOM"))",
        allowClear: true
    });

    $("#BaseUOMddl").change(function () {
        baseUOM = $(this).find('option:selected').text();

        $('#ltrReceivingUOM').html(baseUOM);
        $('.IngUsageUOM:visible').each(function (index, value) {
            var div = $(this);
            $(div).find('span#ltrUsageUOM').html(baseUOM);
        });
    });

    function GetIndexBaseUOM() {
        $('.IngUsageUOM:visible').each(function (index, value) {
            var div = $(this);
            $(div).find('span#ltrIndex').html(index + 1);
            $(div).find('span#ltrUsageUOM').html(baseUOM);
        });
    }
</script>